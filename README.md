# Chord Based Distributed Hash Table
Extend the server-side method stubs generated by Thrift
You must implement methods corresponding to the following 6 server-side methods:
writeFile given a name, owner, and contents, the corresponding file should be written to the server. Metainformation,
such as the owner, version, and content hash (use the SHA-256 hash) should also be stored
at the server side.
If the filename does not exist on the server, a new file should be created with its version attribute set to 0.
Otherwise, the file contents should be overwritten and the version number should be incremented.
If the server does not own the file’s id, a SystemException should be thrown.
readFile if a file with a given name and owner exists on the server, both the contents and meta-information should
be returned. Otherwise, a SystemException should be thrown and appropriate information indicating the
cause of the exception should be included in the SystemException’s message field.
If the server does not own the file’s id, a SystemException should be thrown.
setFingertable sets the current node’s fingertable to the fingertable provided in the argument of the function. I
have provided initialization code (Part 3) that will call this function, but you need to correctly implement this
function on the server side.
findSucc given an identifier in the DHT’s key space, returns the DHT node that owns the id. This function should
be implemented in two parts:
1. the function should call findPred to discover the DHT node that precedes the given id
2. the function should call getNodeSucc to find the successor of this predecessor node
findPred given an identifier in the DHT’s key space, this function should returns the DHT node that immediately
precedes the id. This preceeding node is the first node in the counter-clockwise direction in the Chord key
space. A SystemException should be thrown if no fingertable exists for the current node.
getNodeSucc returns the closest DHT node that follows the current node in the Chord key space. A SystemException
should be thrown if no fingertable exists for the current node.
To properly implement findSucc, findPred, and getNodeSucc, I highly recommend reading the
Chord paper [1] to obtain a clear understanding of the Chord protocol.
According to the Chord protocol, each Chord node is responsible for a portion of the Chord key space (see
[1]). For this assignment, a node’s id is determined by the SHA-256 hash value of the string "<ip address>:<port
number>". A file’s id is determined by the SHA-256 hash value of the string "<owner>:<filename>". Attempts to
writeFile or readFile from a node that does not own the file’s associated SHA-256 id should throw a
SystemException.
Note: When accessing remote.cs.binghamton.edu, you are actually redirected to one of the 8 REMOTE
machines ({remote00, remote01, ..., remote07}.cs.binghamton.edu) using DNS redirection. So you need to make
sure you use the public IP address of the remote machine that the server is running on. For example, the public IP
of remote01.cs.binghamton.edu is 128.226.180.163.
Example: If ten nodes are in the DHT running on 10 different ports on “128.226.117.49:9090”, ...,
“128.226.117.49:9099”, and we want to write the a file “example.txt”, owned by “guest”, then the key
associated with this file SHA256(“guest:example.txt”)=“ad0c...” must be written to the node associated with the
next SHA-256 value in the Chord id space. According to the Chord DHT specification (shown in Figure 1), this
node is “128.226.117.49:9093’, which has an SHA-256 hash of “c529...”.
2
128.226.117.49:9099
guest:example.txt
128.226.117.49:9091
128.226.117.49:9098
128.226.117.49:9093
128.226.117.49:9094
128.226.117.49:9095
128.226.117.49:9092
128.226.117.49:9090
128.226.117.49:9096
128.226.117.49:9097
Figure 1: Example Chord Ring
Every time the server is started any filesystem or other persistent storage that it used should be initialized to be
empty. If your server stores files in the file system, it should use only the current working directory from where it
was run. There is no need to implement directory structure.
In addition, the server executable should take a single command-line argument specifying the port where the
Thrift service will listen for remote clients. For example:
./server 9090
It should use Thrift’s TBinaryProtocol for marshalling and unmarshalling data structures. Multiple servers will be
running at the same time. Servers will also have to send RPC requests (e.g., findPred and getNodeSucc) to
other servers.
  
2 Run the initializer program
For each DHT node, a fingertable needs to be initialized. In this assignment, I have provided a finger table initializer
program that will compute the fingertable (see the Chord specification [1]) for each running DHT node
and send each fingertable (using the setFingertable server method you implement) to the appropriate node.
The initializer program can be downloaded from myCourses. The initializer program takes a filename as its only
command line argument. To run the initializer:
$> chmod +x init
$> ./init nodex.txt
The file (node.txt) should contain a list of IP addresses and ports, in the format “<ip-address>:<port>”, of
all of the running DHT nodes.
For example, if four DHT nodes are running on remote01.cs.binghamton.edu port 9090, 9091, 9092,
and 9093, then nodes.txt should contain:
3
128.226.180.163:9090
128.226.180.163:9091
128.226.180.163:9092
128.226.180.163:9093
The initializer program will print an error message if any of the specified DHT nodes is not available.
4 How to test
This is for testing your implementation only. You do not need to submit this part. It will not be graded.
To test your Chord-based file server implementation, you will need to write your own test program. This test
program will act as a client that issues remote procedure calls to the Chord servers. It will then check if the returned
values are correct.
Your test program need to verify the correctness of all six remote procedure calls supported by the server. For
example, your test program might issue a readFile or writeFile call to a server that does not own this file’s
associated id. It should expect to catch a SystemException, thrown by the server.
To find the correct server to send readFile and writeFile requests to, your test program should first find
the server that owns the key associated with the input user and filename: SHA-256(“<user>:<filename>”)1 using
the findSucc call. Then your test program can call readFile or writeFile on the server returned by the
findSucc call.
